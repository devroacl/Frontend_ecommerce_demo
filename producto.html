<!-- Usando la estructura base -->
<main>
    <div class="row">
        <!-- Imágenes -->
        <div class="col-md-6">
            <div id="productCarousel" class="carousel slide">
                <div class="carousel-inner" id="carouselImages"></div>
                <button class="carousel-control-prev" data-bs-target="#productCarousel" type="button">
                    <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" data-bs-target="#productCarousel" type="button">
                    <span class="carousel-control-next-icon"></span>
                </button>
            </div>
        </div>

        <!-- Detalles -->
        <div class="col-md-6">
            <h1 id="productName"></h1>
            <p class="lead" id="productPrice"></p>
            <p id="productDescription"></p>
            <button class="btn btn-primary btn-lg" onclick="addToCart(productId)">Agregar al carrito</button>

            <!-- Reseñas -->
            <div class="mt-5">
                <h3>Reseñas</h3>
                <div id="reviewsContainer"></div>
                <form id="reviewForm" class="mt-3">
                    <div class="mb-3">
                        <label class="form-label">Calificación</label>
                        <div class="rating">
                            [1,2,3,4,5].map(n => `<span class="star" data-value="${n}">★</span>`).join('')
                        </div>
                    </div>
                    <div class="mb-3">
                        <textarea class="form-control" placeholder="Escribe tu reseña" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Enviar reseña</button>
                </form>
            </div>
        </div>
    </div>
</main>

<script>
let productId = new URLSearchParams(window.location.search).get('id');

document.addEventListener('DOMContentLoaded', async () => {
    const producto = await fetch(`/api/productos/${productId}`).then(res => res.json());
    
    // Mostrar datos del producto
    document.getElementById('productName').textContent = producto.nombre;
    document.getElementById('productPrice').textContent = `$${producto.precio}`;
    document.getElementById('productDescription').textContent = producto.descripcion;
    
    // Carrusel de imágenes
    const carousel = document.getElementById('carouselImages');
    carousel.innerHTML = producto.imagenes.map((img, index) => `
        <div class="carousel-item ${index === 0 ? 'active' : ''}">
            <img src="${img}" class="d-block w-100" alt="${producto.nombre}">
        </div>
    `).join('');

    // Cargar reseñas
    const reviews = await fetch(`/api/productos/${productId}/resenas`).then(res => res.json());
    const reviewsContainer = document.getElementById('reviewsContainer');
    reviewsContainer.innerHTML = reviews.map(review => `
        <div class="card mb-2">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h5>${review.usuario.nombre}</h5>
                    <div>${'★'.repeat(review.calificacion)}</div>
                </div>
                <p>${review.comentario}</p>
            </div>
        </div>
    `).join('');
});
</script>